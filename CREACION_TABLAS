CREATE OR REPLACE PROCEDURE PROC_CREADO_INICIAL 
AS
CREAR_TABLA_PROVINCIA VARCHAR2(10000);
CREAR_TABLA_CLIENTE VARCHAR2(10000);
CREAR_TABLA_FECHA VARCHAR2(10000);
CREAR_TABLA_HECHOS VARCHAR2(10000);

TABLE_DOES_NOT_EXIST EXCEPTION;
PRAGMA EXCEPTION_INIT(TABLE_DOES_NOT_EXIST, -942); -- ORA-00942
BEGIN

CREAR_TABLA_PROVINCIA := 'CREATE TABLE DIM_PROV(
    ID_PROV NUMBER(2) NOT NULL ,  
    DES_NOM_PROV VARCHAR2(30) NOT NULL , 
    FEC_AUDIT TIMESTAMP NOT NULL,
    PRIMARY KEY(ID_PROV))';
    
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE DIM_PROV';
EXCEPTION
    WHEN TABLE_DOES_NOT_EXIST THEN NULL;
END;  
EXECUTE IMMEDIATE CREAR_TABLA_PROVINCIA; 

CREAR_TABLA_CLIENTE := 'CREATE TABLE DIM_CLIENTE (
    ID_DNI NUMBER(1) NOT NULL ,
    COD_CUENTA NUMBER(6) NOT NULL ,
    DES_NOMBRE VARCHAR2(15) NOT NULL ,
    DES_APE1 VARCHAR2(15) NOT NULL , 
    DES_APE2 VARCHAR2(15) NOT NULL ,
    ID_PROV NUMBER(2) NOT NULL ,
    DES_DIR VARCHAR2(50) NOT NULL ,
    FEC_AUDIT TIMESTAMP  NOT NULL ,
    PRIMARY KEY (ID_DNI))';
    
    BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE DIM_CLIENTE';
EXCEPTION
    WHEN TABLE_DOES_NOT_EXIST THEN NULL;
END;  
    EXECUTE IMMEDIATE CREAR_TABLA_CLIENTE;
    
CREAR_TABLA_FECHA := 'CREATE TABLE DIM_FECHA(
    ID_FECHA DATE  NOT NULL ,
    DES_FECHA VARCHAR2(50) NOT NULL ,
    ID_DIA NUMBER(2) NOT NULL ,
    ID_MES NUMBER(2) NOT NULL ,
    DES_MES VARCHAR2(30)  NOT NULL,
    ID_ANO NUMBER(4)  NOT NULL ,
    ID_ANO_MES NUMBER(8) NOT NULL ,
    DES_ANO_MES VARCHAR2(30) NOT NULL , 
    FEC_ULTIM_D_MES DATE  NOT NULL ,
    FEC_PRIM_D_MES DATE NOT NULL , 
    ID_TRIMESTRE NUMBER(1)  NOT NULL ,
    DES_TRIMESTRE VARCHAR2(20) NOT NULL ,
    ID_CUATRIMESTRE NUMBER(1)  NOT NULL,
    DES_CUATRIMESTRE VARCHAR2(20) NOT NULL ,
    FEC_ANO_ANTERIOR DATE NOT NULL ,
    FEC_AUDIT TIMESTAMP NOT NULL ,
    PRIMARY KEY (ID_FECHA))';
    
    BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE DIM_FECHA';
EXCEPTION
    WHEN TABLE_DOES_NOT_EXIST THEN NULL;
END;  
    EXECUTE IMMEDIATE CREAR_TABLA_FECHA;
    
    CREAR_TABLA_HECHOS := 'CREATE TABLE HEC_TRANSAC (
    ID_FECHA DATE  NOT NULL ,
    ID_DNI_CLI_ORIGEN NUMBER(1)  NOT NULL ,
    ID_DNI_CLI_DESTINO NUMBER(1)  NOT NULL ,
    ID_PROV_CLI_ORIGEN NUMBER(2) NOT NULL ,
    ID_PROV_CLI_DESTINO NUMBER(2) NOT NULL ,
    IMP_IMPORTE NUMBER(6,2) NOT NULL ,
    IMP_COMISION NUMBER(4,2) NOT NULL ,
    IMP_TOTAL NUMBER(6,2) NOT NULL ,
    FEC_AUDIT TIMESTAMP NOT NULL) ';
    
    BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE HEC_TRANSAC';
EXCEPTION
    WHEN TABLE_DOES_NOT_EXIST THEN NULL;
END;  
    EXECUTE IMMEDIATE CREAR_TABLA_HECHOS;

END;
/

EXECUTE PROC_CREADO_INICIAL ;
